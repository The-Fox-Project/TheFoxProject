from . import system
from rich.table import Table


def search_exploits(search_query):
    dictionary = system.load_exploitdb_csv()
    found_exploits = []
    for line in dictionary:
        lower_search = search_query.lower()
        description = line["description"].lower()
        split_lower_search = lower_search.split(" ")

        if all(word in description for word in split_lower_search):
            line["description"] = line["description"].replace(lower_search, f"[bold red]{lower_search}[/bold red]")
            found_exploits.append(line)

    return found_exploits


def pretty_print_exploits(exploits, console):
    table = Table(title="Exploit", show_header=True, header_style="bold magenta", leading=True, expand=True)
    table.add_column("ID", style="dim")
    table.add_column("Description")
    table.add_column("Date")
    table.add_column("Author")
    table.add_column("File")
    for exploit in exploits:
        table.add_row(
            exploit["id"],
            exploit["description"],
            exploit["date_published"],
            exploit["author"],
            exploit["file"]
        )
    console.print(table)


if __name__ == "__main__":
    search_query = input("Enter your search query: ")
    search_exploits(search_query)
